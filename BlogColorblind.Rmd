---
title: "Simulate Colorblindness and Grayscale in R"
subtitle: "AKA, why Meaghan hates the default ggplot2 palette"
output: html_document
author: "Meaghan Wetherell"
date: "February 2025"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message=FALSE)
```

# Introduction
There are a few different packages for simulating colorblindness but my personal favorite at the moment is `colorblindr`. Unlike `colorblindness` which is a good alternative, `colorblindr` also shows you tritanopy. That feature makes it worth some of the pain-in-the butt additional code you have to do below.

The examples below use version `r packageVersion("colorblindr")` and there is also a (walkthrough)[https://github.com/clauswilke/colorblindr] available. 

# Install and Load Packages
Unfortunately, `colorblindr` is not on the CRAN server, it is on github. Use the `install_github()` function from the `remotes` packages to install this and its dependencies (`cowplot` and `colorspace`). 
```{r eval = FALSE}
remotes::install_github("wilkelab/cowplot")
install.packages("colorspace", repos = "http://R-Forge.R-project.org")
remotes::install_github("clauswilke/colorblindr")

```

For simulating on base R plots, we'll need an extra package, `ggplotify`. 
```{r eval=FALSE}
install.packages("ggplotify")
```

And then, don't forget to load your packages, including ggplot2
```{r}
library(colorblindr)
library(ggplotify)
library(ggplot2)
```


# Simulate Colorblindness with ggplot2
To start, I'm going to create some a basic graphics for demonstration purposes, using the `iris` dataset.
```{r fig.show = "hide"}
library(ggplot2)
plot1 <- ggplot(data = iris, aes(x = Sepal.Length, fill = Species)) + 
  geom_histogram() + 
  theme(legend.position = "bottom", legend.title = element_blank())
```

Now let's take a look at it. I like this package because it makes it very easy, using a *color vision deficiency* or CVD simulator function to show you the most common deficiencies and what the plot would look like in grayscale. 

```{r}
cvd_grid(plot1)
```


# Simulate Colorblindness with base R
Unfortunately, the regular `cvd_grid()` function doesn't work with base R plots. But there are a few workarounds. The shortest I've found is to turn your plot into a grob, using `as.grob()` from the `ggplotify` package to make it readable. 


```{r}
bad.col <- c(versicolor = "red", setosa = "green", virginica = "orange")

plot3 <- as.grob(~plot(iris$Sepal.Length,  iris$Sepal.Width, col = bad.col[factor(iris$Species)]))

cvd_grid(plot3)
```

A few wierd code points. We have to use `~`, and you can't call out the plot early, name it, and then continue on, which is very odd. 

Turns out that once you use the plot() function, it changes it into a class 'NULL' object and that breaks `as.grob()`'s brains all the way open. So the following versions will not convert to a ggplot object and will not work.

```{r eval = FALSE}
wtf <- plot(iris$Sepal.Length,  iris$Sepal.Width, col = bad.col[factor(iris$Species)])
as.grob(wtf)
as.grob(~wtf)
as.grob(expression(wtf))
```

# Why Meaghan Hates The Default Color Scheme
Yes, the default `ggplot2` colorscheme is a very pretty rainbow... but it is a rainbow of bullshit and garbage. Here is a demonstration of why it's bad. First, let's make some fake data with plenty of groups.
```{r}
x <- rnorm(n = 200, mean = 50, sd = 7)
y <- rnorm(n = 200, mean = 40, sd = 7)
group.letters <- sample(c("A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"),size = 200, replace = TRUE)
fake.data <- data.frame(x, y, group.letters)
smol.fake.data <- fake.data %>% filter(group.letters %in% c("A", "B", "C", "D", "E", "F"))
```

Now, let's make a scatterplot, using all those groups as the color variables. That's 11 groups, which is a lot.
```{r}
start.plot <- ggplot(fake.data, aes(x = x, y = y, col = group.letters)) + geom_point(size = 3)

start.plot
```

Can you tell the difference between F and G? Next to each other, maybe, but I dare you to figure out which one is which on the plot.Find one or two you're super confident about, then look at this labelled plot of them.

```{r}
start.plot + geom_text(label = group.letters, col = "black", nudge_x = .5, nudge_y = .5)
```

So once you get past about 6 categories, the default color scheme is pretty hard to read even if you have super awesome color vision. And if you don't, or if you're printing something in grayscale, that turns out to be even harder:

```{r}
cvd_grid(start.plot)
```

# But Meaghan, What Palettes Should I Use?
There are so, so many! For example, ggplot2 now has the viridis color scheme embedded in it. Which still is rough for an 11 group palette, but works fine for versions with fewer groups.

```{r}
ggplot(smol.fake.data, 
       aes(x = x, y = y, col = group.letters)) + 
  geom_point(size = 3)+ 
  scale_color_viridis_d()
```

And the `colorblindR` package comes with its own helpful little palette for up to 8 groups, `OkabeIto`
```{r}
ggplot(smol.fake.data, 
       aes(x = x, y = y, col = group.letters)) + 
  geom_point(size = 3)+
  scale_color_OkabeIto()
```

And let's not forget that you don't have to use just color! You can change shapes, you can change point sizes, you can facet out by group, or you could combine categories! Just please, please, don't use the default color palette. 
